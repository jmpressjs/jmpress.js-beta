/*!
 * jmpress.js v0.4.4
 * http://jmpressjs.github.com/jmpress.js
 *
 * A jQuery plugin to build a website on the infinite canvas.
 *
 * Copyright 2012 Kyle Robinson Young @shama & Tobias Koppers @sokra
 * Licensed MIT
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Based on the foundation laid by Bartek Szopka @bartaz
 */(function(e,t,a,s){"use strict";function r(e){if(e){var t=1+e.substr(1).search(/[A-Z]/),a=e.substr(0,t).toLowerCase(),s=e.substr(t).toLowerCase();return"-"+a+"-"+s}}function n(e){return e?e+",":""}function i(r){function n(t,a){var s=u(t),r={oldStyle:e(t).attr("style")||""},n={data:s,stepData:r};p.call(this,"beforeInitStep",e(t),n),r.delegate=s.delegate,p.call(this,"initStep",e(t),n),e(t).data("stepData",r),e(t).attr("id")||e(t).attr("id","step-"+(a+1)),p.call(this,"applyStep",e(t),n)}function i(t){var a=e(t).data("stepData");e(t).attr("style",a.oldStyle),p.call(this,"unapplyStep",e(t),{stepData:a})}function o(t){p.call(this,"unapplyStep",e(t),{stepData:t.data("stepData")}),p.call(this,"applyStep",e(t),{stepData:t.data("stepData")})}function c(){Y&&p.call(this,"setInactive",Y,{stepData:e(Y).data("stepData"),reason:"deinit"}),X.jmpressClass&&e(I).removeClass(X.jmpressClass),p.call(this,"beforeDeinit",e(this),{}),e(A.stepSelector,I).each(function(){i.call(I,this)}),P.attr("style",z.container),A.fullscreen&&e("html").attr("style",""),k.attr("style",z.area),e(Z).children().each(function(){I.append(e(this))}),A.fullscreen?Z.remove():(Z.remove(),k.remove()),p.call(this,"afterDeinit",e(this),{}),e(I).data("jmpressmethods",!1)}function p(t,a,s){s.settings=A,s.current=X,s.container=P,s.parents=a?f(a):null,s.current=X,s.jmpress=this;var r={};return e.each(A[t],function(e,t){r.value=t.call(I,a,s)||r.value}),r.value}function f(t){return e(t).parentsUntil(I).not(I).filter(A.stepSelector)}function m(e){return v({step:Y,substep:F},e)}function v(t,a){var r;if(e.isPlainObject(t)&&(r=t.substep,t=t.step),"string"==typeof t&&(t=I.find(t).first()),!t||!e(t).data("stepData"))return!1;g.call(this);var n=e(t).data("stepData"),i=!1;if(p.call(this,"beforeChange",t,{stepData:n,reason:a,cancel:function(){i=!0}}),i)return s;var o={},c=t;e(t).data("stepData").delegate&&(c=e(t).parentsUntil(I).filter(A.stepSelector).filter(n.delegate)||e(t).near(n.delegate)||e(t).near(n.delegate,!0)||e(n.delegate,I),n=c.data("stepData")),O&&p.call(this,"setInactive",O,{stepData:e(O).data("stepData"),delegatedFrom:Y,reason:a,target:o,nextStep:c,nextSubstep:r,nextStepData:n});var l={stepData:n,delegatedFrom:t,reason:a,target:o,substep:r,prevStep:O,prevSubstep:F,prevStepData:O&&e(O).data("stepData")};return p.call(this,"beforeActive",c,l),p.call(this,"setActive",c,l),X.jmpressClass&&e(I).removeClass(X.jmpressClass),e(I).addClass(X.jmpressClass="step-"+e(c).attr("id")),X.jmpressDelegatedClass&&e(I).removeClass(X.jmpressDelegatedClass),e(I).addClass(X.jmpressDelegatedClass="delegating-step-"+e(t).attr("id")),p.call(this,"applyTarget",c,e.extend({canvas:Z,area:k,beforeActive:O},l)),Y=t,F=l.substep,O=c,X.idleTimeout&&clearTimeout(X.idleTimeout),X.idleTimeout=setTimeout(function(){p.call(this,"idle",c,l)},Math.max(1,A.transitionDuration-100)),c}function g(){(function t(){function s(){(0!==e(P).scrollTop()||0!==e(P).scrollLeft())&&t()}if("BODY"===e(P)[0].tagName)try{a.scrollTo(0,0)}catch(r){}e(P).scrollTop(0),e(P).scrollLeft(0),setTimeout(s,1),setTimeout(s,10),setTimeout(s,100),setTimeout(s,200),setTimeout(s,400)})()}function b(e){return v.call(this,e,"jump")}function y(){return v.call(this,p.call(this,"selectNext",Y,{stepData:e(Y).data("stepData"),substep:F}),"next")}function j(){return v.call(this,p.call(this,"selectPrev",Y,{stepData:e(Y).data("stepData"),substep:F}),"prev")}function D(){return v.call(this,p.call(this,"selectHome",Y,{stepData:e(Y).data("stepData")}),"home")}function S(){return v.call(this,p.call(this,"selectEnd",Y,{stepData:e(Y).data("stepData")}),"end")}function x(t){return l(Z,t||{}),e(Z)}function C(){return O&&e(O)}function w(t,a,r){return h[t]?p.call(this,t,a,r):(e.error("callback "+t+" is not registered."),s)}function T(){var e=navigator.userAgent.toLowerCase(),t=-1===e.search(/(iphone)|(ipod)|(android)/);return t}r=e.extend(!0,{},r||{});var M={},N=null;for(N in h)M[N]=e.isFunction(r[N])?[r[N]]:r[N],r[N]=[];var A=e.extend(!0,{},d,r);for(N in h)M[N]&&Array.prototype.push.apply(A[N],M[N]);var I=e(this),P=null,k=null,z={container:"",area:""},Z=null,X=null,Y=!1,F=null,O=!1;if(I.data("jmpressmethods",{select:v,reselect:m,scrollFix:g,goTo:b,next:y,prev:j,home:D,end:S,canvas:x,container:function(){return P},settings:function(){return A},active:C,current:function(){return X},fire:w,init:function(t){n.call(this,e(t),X.nextIdNumber++)},deinit:function(t){t?i.call(this,e(t)):c.call(this)},reapply:o}),T()===!1)return A.notSupportedClass&&I.addClass(A.notSupportedClass),s;A.notSupportedClass&&I.removeClass(A.notSupportedClass);var Q=e(A.stepSelector,I);P=I,k=e("<div />"),Z=e("<div />"),e(I).children().filter(Q).each(function(){Z.append(e(this))}),A.fullscreen&&(P=e("body"),e("html").css({overflow:"hidden"}),k=I),z.area=k.attr("style")||"",z.container=P.attr("style")||"",A.fullscreen?(P.css({height:"100%"}),I.append(Z)):(P.css({position:"relative"}),k.append(Z),I.append(k)),e(P).addClass(A.containerClass),e(k).addClass(A.areaClass),e(Z).addClass(A.canvasClass),t.documentElement.style.height="100%",P.css({overflow:"hidden"});var E={position:"absolute",transitionDuration:"0s"};E=e.extend({},A.animation,E),l(k,E),l(k,{top:"50%",left:"50%",perspective:"1000px"}),l(Z,E),X={},p.call(this,"beforeInit",null,{}),Q.each(function(e){n.call(I,this,e)}),X.nextIdNumber=Q.length,p.call(this,"afterInit",null,{}),v.call(this,p.call(this,"selectInitialStep","init",{})),A.initClass&&e(Q).removeClass(A.initClass)}function o(){return d}function c(t,a){e.isFunction(a)?v[t]?e.error("function "+t+" is already registered."):v[t]=a:h[t]?e.error("callback "+t+" is already registered."):(h[t]=1,d[t]=[])}function l(t,a){var s,r,n={};for(s in a)a.hasOwnProperty(s)&&(r=f(s),null!==r&&(n[r]=a[s]));return e(t).css(n),t}function u(t){function a(e){e=e.split("-");for(var t=1;e.length>t;t++)e[t]=e[t].substr(0,1).toUpperCase()+e[t].substr(1);return e.join("")}if(e(t)[0].dataset)return e.extend({},e(t)[0].dataset);var s={},r=e(t)[0].attributes;return e.each(r,function(e,t){"data-"===t.nodeName.substr(0,5)&&(s[a(t.nodeName.substr(5))]=t.nodeValue)}),s}function p(){return!!e(this).data("jmpressmethods")}var f=function(){var e=t.createElement("dummy").style,a="Webkit Moz O ms Khtml".split(" "),r={};return function(t){if(r[t]===s){var n=t.charAt(0).toUpperCase()+t.substr(1),i=(t+" "+a.join(n+" ")+n).split(" ");r[t]=null;for(var o in i)if(e[i[o]]!==s){r[t]=i[o];break}}return r[t]}}(),d={stepSelector:".step",containerClass:"",canvasClass:"",areaClass:"",notSupportedClass:"not-supported",fullscreen:!0,animation:{transformOrigin:"top left",transitionProperty:n(r(f("transform")))+n(r(f("perspective")))+"opacity",transitionDuration:"1s",transitionDelay:"500ms",transitionTimingFunction:"ease-in-out",transformStyle:"preserve-3d"},transitionDuration:1500},h={beforeChange:1,beforeInitStep:1,initStep:1,beforeInit:1,afterInit:1,beforeDeinit:1,afterDeinit:1,applyStep:1,unapplyStep:1,setInactive:1,beforeActive:1,setActive:1,selectInitialStep:1,selectPrev:1,selectNext:1,selectHome:1,selectEnd:1,idle:1,applyTarget:1};for(var m in h)d[m]=[];var v={init:i,initialized:p,deinit:function(){},css:l,pfx:f,defaults:o,register:c,dataset:u};e.fn.jmpress=function(t){function a(){var a=e(this).data("jmpressmethods");if(a&&a[t])return a[t].apply(this,Array.prototype.slice.call(arguments,1));if(v[t])return v[t].apply(this,Array.prototype.slice.call(arguments,1));if(h[t]&&a){var s=a.settings(),r=Array.prototype.slice.call(arguments,1)[0];e.isFunction(r)&&(s[t]=s[t]||[],s[t].push(r))}else{if("object"==typeof t||!t)return i.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.jmpress")}return this}var s,r=arguments;return e(this).each(function(e,t){s=a.apply(t,r)}),s},e.extend({jmpress:function(t){if(v[t])return v[t].apply(this,Array.prototype.slice.call(arguments,1));if(h[t]){var a=Array.prototype.slice.call(arguments,1)[0];e.isFunction(a)?d[t].push(a):e.error("Second parameter should be a function: $.jmpress( callbackName, callbackFunction )")}else e.error("Method "+t+" does not exist on jQuery.jmpress")}})})(jQuery,document,window),function(e){"use strict";function t(t,a,s,r){var n;return t.each(function(t,i){return r&&(n=a(i,s,r))?!1:e(i).is(s)?(n=i,!1):!r&&(n=a(i,s,r))?!1:undefined}),n}function a(s,r,n){var i=e(s).children();return n&&(i=e(i.get().reverse())),t(i,a,r,n)}function s(s,r,n){return t(e(s)[n?"prevAll":"nextAll"](),a,r,n)}function r(t,a,r){var n,i=e(t).parents();return i=e(i.get()),e.each(i.get(),function(t,i){return r&&e(i).is(a)?(n=i,!1):(n=s(i,a,r),n?!1:undefined)}),n}e.fn.near=function(t,n){var i=[];return e(this).each(function(e,o){var c=(n?!1:a(o,t,n))||s(o,t,n)||r(o,t,n);c&&i.push(c)}),e(i)}}(jQuery,document,window),function(e,t,a,s){"use strict";function r(e){return Math.round(1e4*e)/1e4+""}var n={3:{transform:function(t,a){var s="translate(-50%,-50%)";e.each(a,function(e,t){var a,n=["X","Y","Z"];if("translate"===t[0])s+=" translate3d("+r(t[1]||0)+"px,"+r(t[2]||0)+"px,"+r(t[3]||0)+"px)";else if("rotate"===t[0]){var i=t[4]?[1,2,3]:[3,2,1];for(a=0;3>a;a++)s+=" rotate"+n[i[a]-1]+"("+r(t[i[a]]||0)+"deg)"}else if("scale"===t[0])for(a=0;3>a;a++)s+=" scale"+n[a]+"("+r(t[a+1]||1)+")"}),e.jmpress("css",t,e.extend({},{transform:s}))}},2:{transform:function(t,a){var s="translate(-50%,-50%)";e.each(a,function(e,t){var a=["X","Y"];if("translate"===t[0])s+=" translate("+r(t[1]||0)+"px,"+r(t[2]||0)+"px)";else if("rotate"===t[0])s+=" rotate("+r(t[3]||0)+"deg)";else if("scale"===t[0])for(var n=0;2>n;n++)s+=" scale"+a[n]+"("+r(t[n+1]||1)+")"}),e.jmpress("css",t,e.extend({},{transform:s}))}},1:{transform:function(t,a){var s={top:0,left:0};e.each(a,function(e,t){"translate"===t[0]&&(s.left=Math.round(t[1]||0)+"px",s.top=Math.round(t[2]||0)+"px")}),t.animate(s,1e3)}}},i=function(){return e.jmpress("pfx","perspective")?n[3]:e.jmpress("pfx","transform")?n[2]:n[1]}();e.jmpress("defaults").reasonableAnimation={},e.jmpress("initStep",function(t,a){var s=a.data,r=a.stepData,n=parseFloat;e.extend(r,{x:n(s.x)||0,y:n(s.y)||0,z:n(s.z)||0,r:n(s.r)||0,phi:n(s.phi)||0,rotate:n(s.rotate)||0,rotateX:n(s.rotateX)||0,rotateY:n(s.rotateY)||0,rotateZ:n(s.rotateZ)||0,revertRotate:!1,scale:n(s.scale)||1,scaleX:n(s.scaleX)||!1,scaleY:n(s.scaleY)||!1,scaleZ:n(s.scaleZ)||1})}),e.jmpress("afterInit",function(t,a){var s=a.settings.stepSelector,r=a.current;r.perspectiveScale=1,r.maxNestedDepth=0;for(var n=e(a.jmpress).find(s).children(s);n.length;)r.maxNestedDepth++,n=n.children(s)}),e.jmpress("applyStep",function(t,a){e.jmpress("css",e(t),{position:"absolute",transformStyle:"preserve-3d"}),a.parents.length>0&&e.jmpress("css",e(t),{top:"50%",left:"50%"});var s=a.stepData,r=[["translate",s.x||s.r*Math.sin(s.phi*Math.PI/180),s.y||-s.r*Math.cos(s.phi*Math.PI/180),s.z],["rotate",s.rotateX,s.rotateY,s.rotateZ||s.rotate,!0],["scale",s.scaleX||s.scale,s.scaleY||s.scale,s.scaleZ||s.scale]];i.transform(t,r)}),e.jmpress("setActive",function(t,a){var r=a.target,n=a.stepData,i=r.transform=[];r.perspectiveScale=1;for(var o=a.current.maxNestedDepth;o>(a.parents.length||0);o--)i.push(["scale"],["rotate"],["translate"]);i.push(["scale",1/(n.scaleX||n.scale),1/(n.scaleY||n.scale),1/n.scaleZ]),i.push(["rotate",-n.rotateX,-n.rotateY,-(n.rotateZ||n.rotate)]),i.push(["translate",-(n.x||n.r*Math.sin(n.phi*Math.PI/180)),-(n.y||-n.r*Math.cos(n.phi*Math.PI/180)),-n.z]),r.perspectiveScale*=n.scaleX||n.scale,e.each(a.parents,function(t,a){var s=e(a).data("stepData");i.push(["scale",1/(s.scaleX||s.scale),1/(s.scaleY||s.scale),1/s.scaleZ]),i.push(["rotate",-s.rotateX,-s.rotateY,-(s.rotateZ||s.rotate)]),i.push(["translate",-(s.x||s.r*Math.sin(s.phi*Math.PI/180)),-(s.y||-s.r*Math.cos(s.phi*Math.PI/180)),-s.z]),r.perspectiveScale*=s.scaleX||s.scale}),e.each(i,function(e,t){function r(r){a.current["rotate"+r+"-"+e]===s&&(a.current["rotate"+r+"-"+e]=t[r]||0);var n=a.current["rotate"+r+"-"+e],i=t[r]||0,o=n%360,c=i%360;0>o&&(o+=360),0>c&&(c+=360);var l=c-o;-180>l?l+=360:l>180&&(l-=360),a.current["rotate"+r+"-"+e]=t[r]=n+l}"rotate"===t[0]&&(r(1),r(2),r(3))})}),e.jmpress("applyTarget",function(t,a){var r,n=a.target,o=(a.stepData,a.settings),c=1.3*n.perspectiveScale<a.current.perspectiveScale,l=n.perspectiveScale>1.3*a.current.perspectiveScale,u=-1;e.each(n.transform,function(e,t){return 1>=t.length||"rotate"===t[0]&&0===t[1]%360&&0===t[2]%360&&0===t[3]%360?s:"scale"!==t[0]?!1:(u=e,s)}),u!==a.current.oldLastScale&&(c=l=!1,a.current.oldLastScale=u);var p=[];if(-1!==u)for(;u>=0;)"scale"===n.transform[u][0]&&(p.push(n.transform[u]),n.transform[u]=["scale"]),u--;var f=o.animation;o.reasonableAnimation[a.reason]&&(f=e.extend({},f,o.reasonableAnimation[a.reason])),r={perspective:Math.round(1e3*n.perspectiveScale)+"px"},r=e.extend({},f,r),c||(r.transitionDelay="0s"),a.beforeActive||(r.transitionDuration="0s",r.transitionDelay="0s"),e.jmpress("css",a.area,r),i.transform(a.area,p),r=e.extend({},f),l||(r.transitionDelay="0s"),a.beforeActive||(r.transitionDuration="0s",r.transitionDelay="0s"),a.current.perspectiveScale=n.perspectiveScale,e.jmpress("css",a.canvas,r),i.transform(a.canvas,n.transform)})}(jQuery,document,window),function(e){"use strict";var t=e.jmpress,a="activeClass",s="nestedActiveClass",r=t("defaults");r[s]="nested-active",r[a]="active",t("setInactive",function(t,r){var n=r.settings,i=n[a],o=n[s];i&&e(t).removeClass(i),o&&e.each(r.parents,function(t,a){e(a).removeClass(o)})}),t("setActive",function(t,r){var n=r.settings,i=n[a],o=n[s];i&&e(t).addClass(i),o&&e.each(r.parents,function(t,a){e(a).addClass(o)})})}(jQuery,document,window),function(e){"use strict";function t(t,a){return e(this).find(a.settings.stepSelector).first()}function a(t,a,s,r){if(!a)return!1;var n=s.settings.stepSelector;a=e(a);do{var i=a.near(n,r);if((0===i.length||0===i.closest(t).length)&&(i=e(t).find(n)[r?"last":"first"]()),!i.length)return!1;a=i}while(a.data("stepData").exclude);return a}var s=e.jmpress;s("initStep",function(e,t){t.stepData.exclude=t.data.exclude&&-1===["false","no"].indexOf(t.data.exclude)}),s("selectInitialStep",t),s("selectHome",t),s("selectEnd",function(t,a){return e(this).find(a.settings.stepSelector).last()}),s("selectPrev",function(e,t){return a(this,e,t,!0)}),s("selectNext",function(e,t){return a(this,e,t)})}(jQuery,document,window),function(e,t,a,s){"use strict";function r(){return""+Math.round(1e5*Math.random(),0)}function n(t){try{var r=e("#"+a.location.hash.replace(/^#\/?/,""));return r.length>0&&r.is(t.stepSelector)?r:s}catch(n){}}function i(e){var t="#/"+e;a.history&&a.history.pushState?a.location.hash!==t&&a.history.pushState({},"",t):a.location.hash!==t&&(a.location.hash=t)}var o=e.jmpress,c="a[href^=#]";o("defaults").hash={use:!0,update:!0,bindChange:!0},o("selectInitialStep",function(t,o){var l=o.settings,u=l.hash,p=o.current,f=e(this);return o.current.hashNamespace=".jmpress-"+r(),u.use?(u.bindChange&&(e(a).bind("hashchange"+p.hashNamespace,function(e){var t=n(l);f.jmpress("initialized")&&f.jmpress("scrollFix"),t&&t.length&&(t.attr("id")!==f.jmpress("active").attr("id")&&f.jmpress("select",t),i(t.attr("id"))),e.preventDefault()}),e(c).on("click"+p.hashNamespace,function(t){var a=e(this).attr("href");try{e(a).is(l.stepSelector)&&(f.jmpress("select",a),t.preventDefault(),t.stopPropagation())}catch(s){}})),n(l)):s}),o("afterDeinit",function(t,s){e(c).off(s.current.hashNamespace),e(a).unbind(s.current.hashNamespace)}),o("setActive",function(t,a){var s=a.settings,r=a.current;s.hash.use&&s.hash.update&&(clearTimeout(r.hashtimeout),r.hashtimeout=setTimeout(function(){i(e(a.delegatedFrom).attr("id"))},s.transitionDuration+200))})}(jQuery,document,window),function(e,t,a,s){"use strict";function r(){return""+Math.round(1e5*Math.random(),0)}function n(e){e.preventDefault(),e.stopPropagation()}var i=e.jmpress,o="next",c="prev";i("defaults").keyboard={use:!0,keys:{33:c,37:c,38:c,9:o+":"+c,32:o,34:o,39:o,40:o,36:"home",35:"end"},ignore:{INPUT:[32,37,38,39,40],TEXTAREA:[32,37,38,39,40],SELECT:[38,40]},tabSelector:"a[href]:visible, :input:visible"},i("afterInit",function(a,i){var o=i.settings,c=o.keyboard,l=c.ignore,u=i.current,p=e(this);o.fullscreen||p.attr("tabindex",0),u.keyboardNamespace=".jmpress-"+r(),e(o.fullscreen?t:p).bind("keypress"+u.keyboardNamespace,function(e){for(var t in l)if(e.target.nodeName===t&&-1!==l[t].indexOf(e.which))return;(e.which>=37&&40>=e.which||32===e.which)&&n(e)}),e(o.fullscreen?t:p).bind("keydown"+u.keyboardNamespace,function(t){var a=e(t.target);if((o.fullscreen||a.closest(p).length)&&c.use){for(var r in l)if(a[0].nodeName===r&&-1!==l[r].indexOf(t.which))return;var i,u=!1;if(9===t.which){if(a.closest(p.jmpress("active")).length?(i=a.near(c.tabSelector,t.shiftKey),e(i).closest(o.stepSelector).is(p.jmpress("active"))||(i=s)):t.shiftKey?u=!0:i=p.jmpress("active").find("a[href], :input").filter(":visible").first(),i&&i.length>0)return i.focus(),p.jmpress("scrollFix"),n(t),s;t.shiftKey&&(u=!0)}var f=c.keys[t.which];"string"==typeof f?(-1!==f.indexOf(":")&&(f=f.split(":"),f=t.shiftKey?f[1]:f[0]),p.jmpress(f),n(t)):e.isFunction(f)?f.call(p,t):f&&(p.jmpress.apply(p,f),n(t)),u&&(i=p.jmpress("active").find("a[href], :input").filter(":visible").last(),i.focus(),p.jmpress("scrollFix"))}})}),i("afterDeinit",function(a,s){e(t).unbind(s.current.keyboardNamespace)})}(jQuery,document,window),function(e){"use strict";function t(){return""+Math.round(1e5*Math.random(),0)}var a=e.jmpress;a("defaults").mouse={clickSelects:!0},a("afterInit",function(a,s){var r=s.settings,n=r.stepSelector,i=s.current,o=e(this);i.clickableStepsNamespace=".jmpress-"+t(),o.bind("click"+i.clickableStepsNamespace,function(t){if(r.mouse.clickSelects&&!i.userZoom){var a=e(t.target).closest(n);a.is(o.jmpress("active"))||a.length&&(o.jmpress("select",a[0],"click"),t.preventDefault(),t.stopPropagation())}})}),a("afterDeinit",function(t,a){e(this).unbind(a.current.clickableStepsNamespace)})}(jQuery,document,window);